@using System.Configuration
@{
    ViewBag.Title = "Bootstrap Theme Changer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="http://csharpindepth.com/codestyles.css" />

<div class="container">
    @using(Html.BeginForm("SaveBootstrapTheme","Examples",FormMethod.Post))                 
    {
        @Html.AntiForgeryToken()
        <div class="form-horizontal col-lg-8 col-lg-offset-2">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Settings
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label for=".BootstrapTheme" class="control-label">Bootstrap Theme</label>
                        </div>
                        <div class="col-md-8 form-inline">
                            <select class="form-control" id="bootstrapTheme" name="bootstrapTheme">
                                @foreach (var theme in Directory.GetFiles(Server.MapPath("~/Content/")).Where(x => x.Contains("bootstrap.") && x.EndsWith(".css") && !x.Contains(".min.")).Select(x => new FileInfo(x)))
                                {
                                    <option value="@theme.Name" @Html.Raw(theme.Name == ConfigurationManager.AppSettings["bootstrapTheme"] ? "selected" : string.Empty)>@theme.Name</option>
                                }
                            </select>
                            <input type="submit" value="Save Theme" onclick="javascript: $(this).val('Saving...').prop('disabled', true); document.forms[0].submit();" class="btn btn-success" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-offset-4 col-md-8">
                            <span class="text-info"><strong>Note:</strong>&nbsp;These changes affect all visitors.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    <div class="col-lg-12">
        Controller:
<pre>
<code>
// POST: SaveBootstrapTheme
[HttpPost]
[ValidateAntiForgeryToken]
public ActionResult SaveBootstrapTheme(FormCollection formData)
{
    // We're going to be making config changes here.  We have to create a new Configuration based on our
    // current App.config values.
    var config = System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration("~");

    // Set the appSettings key 'bootstrapTheme' to the selected value from the form.
    config.AppSettings.Settings["bootstrapTheme"].Value = formData["bootstrapTheme"];

    // Save the configuration change.
    config.Save(ConfigurationSaveMode.Modified);
    
    // Refresh the current App.Config with the new values.
    ConfigurationManager.RefreshSection("appSettings");

    // Return to the selector page.  I had this setup as AJAX before, but was having issues performing AJAX refresh
    // of an entire view (including layout.cshtml).
    return RedirectToAction("ThemeChanger", "Examples");
}
</code>
</pre>
        CSHTML Form:
<pre>
<code>
@@using(Html.BeginForm(&quot;SaveBootstrapTheme&quot;,&quot;Examples&quot;,FormMethod.Post)) { 

    @@Html.AntiForgeryToken()

    &lt;div class=&quot;form-horizontal col-lg-8 col-lg-offset-2&quot;&gt;
        &lt;div class=&quot;panel panel-default&quot;&gt;
            &lt;div class=&quot;panel-heading&quot;&gt;
                Bootstrap Theme Changer
            &lt;/div&gt;
            &lt;div class=&quot;panel-body&quot;&gt;
                &lt;div class=&quot;row&quot;&gt;
                    &lt;div class=&quot;col-md-4&quot;&gt;
                      &lt;label for=&quot;.BootstrapTheme&quot; class=&quot;control-label&quot;&gt;Bootstrap Theme&lt;/label&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;col-md-8&quot;&gt;
                        &lt;select class=&quot;form-control&quot; id=&quot;bootstrapTheme&quot; name=&quot;bootstrapTheme&quot;&gt;
                            @@foreach (var theme in Directory.GetFiles(Server.MapPath(&quot;~/Content/&quot;))
                            .Where(x =&gt; x.Contains(&quot;bootstrap.&quot;) &amp;&amp; x.EndsWith(&quot;.css&quot;) &amp;&amp; !x.Contains(&quot;.min.&quot;))
                            .Select(x =&gt; new FileInfo(x))) 
                            {           
                               &lt;option value=&quot;@@theme.Name&quot; @@Html.Raw(theme.Name == ConfigurationManager.AppSettings[&quot;bootstrapTheme&quot;] ? &quot;selected&quot; : string.Empty)&gt;@@theme.Name&lt;/option&gt;
                            }
                        &lt;/select&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;div class=&quot;col-md-4 col-md-offset-4&quot; style=&quot;padding-top:8px;&quot;&gt;
                      &lt;input type=&quot;submit&quot; value=&quot;Save Settings&quot; class=&quot;btn btn-success&quot; /&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;div class=&quot;col-md-8 col-md-offset-4&quot;&gt;
                        &lt;div id=&quot;ajaxResult&quot;&gt;
                              &lt;!-- Result of AJAX call here. --&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
}
</code>
</pre>
</div>
</div>
        
